{
  "name": "default-smoke",
  "requiredTools": ["deluge_health", "deluge_validate", "deluge_fix", "deluge_explain", "deluge_examples"],
  "requiredResources": [
    "deluge://rules/v1",
    "deluge://cheatsheet/beginner",
    "deluge://topics/v1",
    "deluge://canonical-index/v1",
    "deluge://coverage/v1"
  ],
  "steps": [
    {
      "name": "health",
      "type": "tool",
      "tool": "deluge_health",
      "args": { "verbose": true },
      "assert": {
        "isError": false,
        "structuredHasKeys": ["status", "knowledge", "server", "uptime_ms"],
        "structuredPathEqualsOneOf": [{ "path": "status", "oneOf": ["ok", "degraded"] }]
      }
    },
    {
      "name": "validate-bounds",
      "type": "tool",
      "tool": "deluge_validate",
      "args": {
        "code": "listVar = {\"A\", \"B\"};\nvalue = listVar.get(2);",
        "strict": true
      },
      "assert": {
        "isError": false,
        "textIncludes": ["runtime.index_out_of_bounds"]
      }
    },
    {
      "name": "fix-semicolon",
      "type": "tool",
      "tool": "deluge_fix",
      "args": {
        "code": "a = 1\ninfo a",
        "style": "minimal-change"
      },
      "assert": {
        "isError": false,
        "textIncludes": ["a = 1;", "info a;"]
      }
    },
    {
      "name": "examples-get",
      "type": "tool",
      "tool": "deluge_examples",
      "args": {
        "topic": "get",
        "query": "map get",
        "max_results": 3,
        "require_source_allowlist": true
      },
      "assert": {
        "isError": false,
        "textIncludes": ["title", "source", "score", "match_reasons", "snippet_id", "canonical_key", "tier"]
      }
    },
    {
      "name": "rules-resource",
      "type": "resource",
      "uri": "deluge://rules/v1",
      "assert": {
        "resourceTextIncludes": ["Deluge Syntax Rules", "sourceAllowlist"]
      }
    },
    {
      "name": "cheatsheet-resource",
      "type": "resource",
      "uri": "deluge://cheatsheet/beginner",
      "assert": {
        "resourceTextIncludes": ["Deluge Beginner Cheatsheet", "map", "if"]
      }
    },
    {
      "name": "topics-resource",
      "type": "resource",
      "uri": "deluge://topics/v1",
      "assert": {
        "resourceTextIncludes": ["\"version\": \"v1\"", "\"topics\""]
      }
    },
    {
      "name": "canonical-index-resource",
      "type": "resource",
      "uri": "deluge://canonical-index/v1",
      "assert": {
        "resourceTextIncludes": ["\"canonical_index\"", "\"variantCount\""]
      }
    },
    {
      "name": "coverage-resource",
      "type": "resource",
      "uri": "deluge://coverage/v1",
      "assert": {
        "resourceTextIncludes": ["\"coverage\"", "\"summary\""]
      }
    }
  ]
}
